{
    "$schema": "https://vega.github.io/schema/vega/v5.json",
    "autosize": "pad",
    "padding": 5,
    "signals": [
      {"name": "child_width", "value": 20},
      {"name": "y_step", "value": 20},
      {
        "name": "child_height",
        "update": "bandspace(domain('y').length, 0.1, 0.05) * y_step"
      }
    ],
    "layout": {
      "padding": 20,
      "offset": {"columnTitle": 10},
      "columns": {"signal": "length(data('column_domain'))"},
      "bounds": "full",
      "align": "all"
    },
    "marks": [
      {
        "name": "column-title",
        "type": "group",
        "role": "column-title",
        "title": {"text": "type", "style": "guide-title", "offset": 10}
      },
      {
        "name": "row_header",
        "type": "group",
        "role": "row-header",
        "encode": {"update": {"height": {"signal": "child_height"}}},
        "axes": [
          {
            "scale": "y",
            "orient": "left",
            "grid": false,
            "title": "position",
            "labelOverlap": true,
            "zindex": 1
          }
        ]
      },
      {
        "name": "column_header",
        "type": "group",
        "role": "column-header",
        "from": {"data": "column_domain"},
        "sort": {"field": "datum[\"type\"]", "order": "ascending"},
        "title": {
          "text": {"signal": "''+parent[\"type\"]"},
          "style": "guide-label",
          "frame": "group",
          "offset": 10
        },
        "encode": {"update": {"width": {"signal": "child_width"}}}
      },
      {
        "name": "cell",
        "type": "group",
        "style": "cell",
        "from": {
          "facet": {"name": "facet", "data": "data_0", "groupby": ["type"]}
        },
        "sort": {"field": ["datum[\"type\"]"], "order": ["ascending"]},
        "encode": {
          "update": {
            "width": {"signal": "child_width"},
            "height": {"signal": "child_height"}
          }
        },
        "signals": [{"name": "width", "update": "child_width"}],
        "marks": [
          {
            "name": "child_marks",
            "type": "rect",
            "style": ["bar"],
            "from": {"data": "facet"},
            "encode": {
              "update": {
                "fill": {"scale": "color", "field": "freq"},
                "xc": {"signal": "child_width", "mult": 0.5},
                "width": {"value": 19},
                "y": {"scale": "y", "field": "position"},
                "height": {"scale": "y", "band": true}
              }
            }
          }
        ]
      }
    ],
    "scales": [
      {
        "name": "y",
        "type": "band",
        "domain": {"data": "data_0", "field": "position", "sort": true},
        "range": {"step": {"signal": "y_step"}},
        "paddingInner": 0.1,
        "paddingOuter": 0.05
      },
      {
        "name": "color",
        "type": "linear",
        "domain": {"data": "data_0", "field": "freq"},
        "range": {"scheme": "magma"},
        "interpolate": "hcl",
        "zero": false
      }
    ],
    "legends": [
      {
        "fill": "color",
        "gradientLength": {"signal": "clamp(child_height, 64, 200)"},
        "symbolType": "circle",
        "title": "freq"
      }
    ]
  }